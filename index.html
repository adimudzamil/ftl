<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malaysia Airlines FTL Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .calculator {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 100%;
            max-width: 600px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #1a3a8f;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .reference-note {
            color: #666;
            font-size: 0.85rem;
            font-style: italic;
        }
        
        .calculator-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .calc-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #1a3a8f;
            background-color: white;
            color: #1a3a8f;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .calc-btn.active {
            background-color: #1a3a8f;
            color: white;
        }
        
        .calc-btn:hover {
            background-color: #0a2463;
            color: white;
        }
        
        .calculator-form {
            display: none;
        }
        
        .calculator-form.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .time-gmt-container {
            display: flex;
            gap: 10px;
        }
        
        .time-input {
            flex: 2;
        }
        
        .gmt-input {
            flex: 1;
        }
        
        .gmt-select {
            font-size: 0.85rem;
        }
        
        button {
            background-color: #1a3a8f;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #0a2463;
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
            display: none;
        }
        
        .result-item {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .ok {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .danger {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .time-display {
            font-size: 1.1rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .limits-info {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #e9ecef;
            font-size: 0.85rem;
        }
        
        .limits-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .limits-table th, .limits-table td {
            padding: 5px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .limits-table th {
            background-color: #1a3a8f;
            color: white;
        }
        
        .night-periods {
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .night-period {
            margin-bottom: 5px;
            padding: 5px;
            background-color: #f8f9fa;
            border-radius: 3px;
        }
        
        .gmt-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .input-description {
            font-size: 0.75rem;
            color: #666;
            margin-top: 3px;
            font-style: italic;
            line-height: 1.3;
        }
        
        .gmt-comparison {
            margin-top: 10px;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 5px;
            font-size: 0.85rem;
        }
        
        .non-acclimatized-info {
            margin-top: 10px;
            padding: 8px;
            background-color: #fff3cd;
            border-radius: 5px;
            font-size: 0.85rem;
            border-left: 3px solid #ffc107;
        }
        
        .table-section {
            margin-top: 20px;
        }
        
        .section-title {
            color: #1a3a8f;
            margin-bottom: 10px;
            font-size: 1.1rem;
            border-bottom: 2px solid #1a3a8f;
            padding-bottom: 5px;
        }
        
        .footnote {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 0.8rem;
        }
        
        .crew-results {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .crew-result {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        
        .crew-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #1a3a8f;
        }
        
        .special-condition {
            font-size: 0.8rem;
            margin-top: 5px;
            color: #666;
            font-style: italic;
        }
        
        .table-reference {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
        }
        
        .aircraft-type-container {
            display: flex;
            gap: 10px;
        }
        
        .aircraft-type-group {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="header">
            <h1>Malaysia Airlines FTL Calculator</h1>
            <div class="reference-note">Based on OM-A issue 10 revision 1 Ch7.5.8, dated 20/06/25.</div>
        </div>
        
        <!-- Calculator Selector -->
        <div class="calculator-selector">
            <button class="calc-btn active" data-calc="cabin">Cabin Crew Calculator</button>
            <button class="calc-btn" data-calc="tech">Tech Crew Calculator</button>
        </div>
        
        <!-- Cabin Crew Calculator -->
        <div id="cabin-calculator" class="calculator-form active">
            <div class="input-group">
                <label>Aircraft Type</label>
                <select id="cabinAircraftType">
                    <option value="737">737</option>
                    <option value="widebody">332/333/339/350</option>
                </select>
                <div class="input-description">Select your aircraft type</div>
            </div>
            
            <div class="input-group">
                <label for="cabinBaseGMT">Current GMT</label>
                <select id="cabinBaseGMT" class="gmt-select">
                    <option value="-12">GMT-12:00</option>
                    <option value="-11.75">GMT-11:45</option>
                    <option value="-11">GMT-11:00</option>
                    <option value="-10">GMT-10:00</option>
                    <option value="-9.5">GMT-09:30</option>
                    <option value="-9">GMT-09:00</option>
                    <option value="-8">GMT-08:00</option>
                    <option value="-7">GMT-07:00</option>
                    <option value="-6">GMT-06:00</option>
                    <option value="-5">GMT-05:00</option>
                    <option value="-4">GMT-04:00</option>
                    <option value="-3.5">GMT-03:30</option>
                    <option value="-3">GMT-03:00</option>
                    <option value="-2">GMT-02:00</option>
                    <option value="-1">GMT-01:00</option>
                    <option value="0">GMT+00:00</option>
                    <option value="1">GMT+01:00</option>
                    <option value="2">GMT+02:00</option>
                    <option value="3">GMT+03:00</option>
                    <option value="3.5">GMT+03:30</option>
                    <option value="4">GMT+04:00</option>
                    <option value="4.5">GMT+04:30</option>
                    <option value="5">GMT+05:00</option>
                    <option value="5.5">GMT+05:30</option>
                    <option value="5.75">GMT+05:45</option>
                    <option value="6">GMT+06:00</option>
                    <option value="6.5">GMT+06:30</option>
                    <option value="7">GMT+07:00</option>
                    <option value="8" selected>GMT+08:00</option>
                    <option value="9">GMT+09:00</option>
                    <option value="9.5">GMT+09:30</option>
                    <option value="10">GMT+10:00</option>
                    <option value="10.5">GMT+10:30</option>
                    <option value="11">GMT+11:00</option>
                    <option value="12">GMT+12:00</option>
                </select>
                <div class="gmt-info">Select your current GMT, the place where you are departing from today.</div>
            </div>
            
            <div class="input-group">
                <label for="cabinLastDepartureGMT">Last Departure Station GMT</label>
                <select id="cabinLastDepartureGMT" class="gmt-select">
                    <option value="-12">GMT-12:00</option>
                    <option value="-11.75">GMT-11:45</option>
                    <option value="-11">GMT-11:00</option>
                    <option value="-10">GMT-10:00</option>
                    <option value="-9.5">GMT-09:30</option>
                    <option value="-9">GMT-09:00</option>
                    <option value="-8">GMT-08:00</option>
                    <option value="-7">GMT-07:00</option>
                    <option value="-6">GMT-06:00</option>
                    <option value="-5">GMT-05:00</option>
                    <option value="-4">GMT-04:00</option>
                    <option value="-3.5">GMT-03:30</option>
                    <option value="-3">GMT-03:00</option>
                    <option value="-2">GMT-02:00</option>
                    <option value="-1">GMT-01:00</option>
                    <option value="0">GMT+00:00</option>
                    <option value="1">GMT+01:00</option>
                    <option value="2">GMT+02:00</option>
                    <option value="3">GMT+03:00</option>
                    <option value="3.5">GMT+03:30</option>
                    <option value="4">GMT+04:00</option>
                    <option value="4.5">GMT+04:30</option>
                    <option value="5">GMT+05:00</option>
                    <option value="5.5">GMT+05:30</option>
                    <option value="5.75">GMT+05:45</option>
                    <option value="6">GMT+06:00</option>
                    <option value="6.5">GMT+06:30</option>
                    <option value="7">GMT+07:00</option>
                    <option value="8" selected>GMT+08:00</option>
                    <option value="9">GMT+09:00</option>
                    <option value="9.5">GMT+09:30</option>
                    <option value="10">GMT+10:00</option>
                    <option value="10.5">GMT+10:30</option>
                    <option value="11">GMT+11:00</option>
                    <option value="12">GMT+12:00</option>
                </select>
                <div class="gmt-info">Select last departure station timezone</div>
            </div>
            
            <div class="input-group">
                <label for="cabinLastDutyEnd">Last Duty End Date and Time</label>
                <div class="time-gmt-container">
                    <div class="time-input">
                        <input type="datetime-local" id="cabinLastDutyEnd" required>
                    </div>
                    <div class="gmt-input">
                        <select id="cabinLastDutyEndGMT" class="gmt-select">
                            <option value="-12">GMT-12:00</option>
                            <option value="-11.75">GMT-11:45</option>
                            <option value="-11">GMT-11:00</option>
                            <option value="-10">GMT-10:00</option>
                            <option value="-9.5">GMT-09:30</option>
                            <option value="-9">GMT-09:00</option>
                            <option value="-8">GMT-08:00</option>
                            <option value="-7">GMT-07:00</option>
                            <option value="-6">GMT-06:00</option>
                            <option value="-5">GMT-05:00</option>
                            <option value="-4">GMT-04:00</option>
                            <option value="-3.5">GMT-03:30</option>
                            <option value="-3">GMT-03:00</option>
                            <option value="-2">GMT-02:00</option>
                            <option value="-1">GMT-01:00</option>
                            <option value="0">GMT+00:00</option>
                            <option value="1">GMT+01:00</option>
                            <option value="2">GMT+02:00</option>
                            <option value="3">GMT+03:00</option>
                            <option value="3.5">GMT+03:30</option>
                            <option value="4">GMT+04:00</option>
                            <option value="4.5">GMT+04:30</option>
                            <option value="5">GMT+05:00</option>
                            <option value="5.5">GMT+05:30</option>
                            <option value="5.75">GMT+05:45</option>
                            <option value="6">GMT+06:00</option>
                            <option value="6.5">GMT+06:30</option>
                            <option value="7">GMT+07:00</option>
                            <option value="8" selected>GMT+08:00</option>
                            <option value="9">GMT+09:00</option>
                            <option value="9.5">GMT+09:30</option>
                            <option value="10">GMT+10:00</option>
                            <option value="10.5">GMT+10:30</option>
                            <option value="11">GMT+11:00</option>
                            <option value="12">GMT+12:00</option>
                        </select>
                    </div>
                </div>
                <div class="input-description">Check last duty end time in your roster (STA + 30 minutes) or (ATA + 30 minutes)</div>
            </div>
            
            <div class="input-group">
                <label for="cabinDutyStart">Start Time</label>
                <div class="time-gmt-container">
                    <div class="time-input">
                        <input type="datetime-local" id="cabinDutyStart" required>
                    </div>
                    <div class="gmt-input">
                        <select id="cabinStartGMT" class="gmt-select">
                            <option value="-12">GMT-12:00</option>
                            <option value="-11.75">GMT-11:45</option>
                            <option value="-11">GMT-11:00</option>
                            <option value="-10">GMT-10:00</option>
                            <option value="-9.5">GMT-09:30</option>
                            <option value="-9">GMT-09:00</option>
                            <option value="-8">GMT-08:00</option>
                            <option value="-7">GMT-07:00</option>
                            <option value="-6">GMT-06:00</option>
                            <option value="-5">GMT-05:00</option>
                            <option value="-4">GMT-04:00</option>
                            <option value="-3.5">GMT-03:30</option>
                            <option value="-3">GMT-03:00</option>
                            <option value="-2">GMT-02:00</option>
                            <option value="-1">GMT-01:00</option>
                            <option value="0">GMT+00:00</option>
                            <option value="1">GMT+01:00</option>
                            <option value="2">GMT+02:00</option>
                            <option value="3">GMT+03:00</option>
                            <option value="3.5">GMT+03:30</option>
                            <option value="4">GMT+04:00</option>
                            <option value="4.5">GMT+04:30</option>
                            <option value="5">GMT+05:00</option>
                            <option value="5.5">GMT+05:30</option>
                            <option value="5.75">GMT+05:45</option>
                            <option value="6">GMT+06:00</option>
                            <option value="6.5">GMT+06:30</option>
                            <option value="7">GMT+07:00</option>
                            <option value="8" selected>GMT+08:00</option>
                            <option value="9">GMT+09:00</option>
                            <option value="9.5">GMT+09:30</option>
                            <option value="10">GMT+10:00</option>
                            <option value="10.5">GMT+10:30</option>
                            <option value="11">GMT+11:00</option>
                            <option value="12">GMT+12:00</option>
                        </select>
                    </div>
                </div>
                <div class="input-description">Reporting time at Base/ ex-Station.</div>
            </div>
            
            <div class="input-group">
                <label for="cabinDutyEnd">End Time</label>
                <div class="time-gmt-container">
                    <div class="time-input">
                        <input type="datetime-local" id="cabinDutyEnd" required>
                    </div>
                    <div class="gmt-input">
                        <select id="cabinEndGMT" class="gmt-select">
                            <option value="-12">GMT-12:00</option>
                            <option value="-11.75">GMT-11:45</option>
                            <option value="-11">GMT-11:00</option>
                            <option value="-10">GMT-10:00</option>
                            <option value="-9.5">GMT-09:30</option>
                            <option value="-9">GMT-09:00</option>
                            <option value="-8">GMT-08:00</option>
                            <option value="-7">GMT-07:00</option>
                            <option value="-6">GMT-06:00</option>
                            <option value="-5">GMT-05:00</option>
                            <option value="-4">GMT-04:00</option>
                            <option value="-3.5">GMT-03:30</option>
                            <option value="-3">GMT-03:00</option>
                            <option value="-2">GMT-02:00</option>
                            <option value="-1">GMT-01:00</option>
                            <option value="0">GMT+00:00</option>
                            <option value="1">GMT+01:00</option>
                            <option value="2">GMT+02:00</option>
                            <option value="3">GMT+03:00</option>
                            <option value="3.5">GMT+03:30</option>
                            <option value="4">GMT+04:00</option>
                            <option value="4.5">GMT+04:30</option>
                            <option value="5">GMT+05:00</option>
                            <option value="5.5">GMT+05:30</option>
                            <option value="5.75">GMT+05:45</option>
                            <option value="6">GMT+06:00</option>
                            <option value="6.5">GMT+06:30</option>
                            <option value="7">GMT+07:00</option>
                            <option value="8" selected>GMT+08:00</option>
                            <option value="9">GMT+09:00</option>
                            <option value="9.5">GMT+09:30</option>
                            <option value="10">GMT+10:00</option>
                            <option value="10.5">GMT+10:30</option>
                            <option value="11">GMT+11:00</option>
                            <option value="12">GMT+12:00</option>
                        </select>
                    </div>
                </div>
                <div class="input-description">Final sector STA/ATA. FDP does not count +30 minutes post flight duty time.</div>
            </div>
            
            <div class="input-group">
                <label for="cabinSectors">Number of Sectors</label>
                <input type="number" id="cabinSectors" min="1" max="4" value="1" required>
            </div>
            
            <button id="calculateCabinBtn">Calculate Cabin Crew Limits</button>
            
            <div class="results" id="cabinResults">
                <div id="cabinResultContent">
                    <!-- Results will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Tech Crew Calculator -->
        <div id="tech-calculator" class="calculator-form">
            <div class="input-group">
                <label>Aircraft Type</label>
                <select id="techAircraftType">
                    <option value="737">737</option>
                    <option value="widebody">332/333/339/350</option>
                </select>
                <div class="input-description">Select your aircraft type</div>
            </div>
            
            <div class="input-group">
                <label for="techBaseGMT">Current GMT</label>
                <select id="techBaseGMT" class="gmt-select">
                    <option value="-12">GMT-12:00</option>
                    <option value="-11.75">GMT-11:45</option>
                    <option value="-11">GMT-11:00</option>
                    <option value="-10">GMT-10:00</option>
                    <option value="-9.5">GMT-09:30</option>
                    <option value="-9">GMT-09:00</option>
                    <option value="-8">GMT-08:00</option>
                    <option value="-7">GMT-07:00</option>
                    <option value="-6">GMT-06:00</option>
                    <option value="-5">GMT-05:00</option>
                    <option value="-4">GMT-04:00</option>
                    <option value="-3.5">GMT-03:30</option>
                    <option value="-3">GMT-03:00</option>
                    <option value="-2">GMT-02:00</option>
                    <option value="-1">GMT-01:00</option>
                    <option value="0">GMT+00:00</option>
                    <option value="1">GMT+01:00</option>
                    <option value="2">GMT+02:00</option>
                    <option value="3">GMT+03:00</option>
                    <option value="3.5">GMT+03:30</option>
                    <option value="4">GMT+04:00</option>
                    <option value="4.5">GMT+04:30</option>
                    <option value="5">GMT+05:00</option>
                    <option value="5.5">GMT+05:30</option>
                    <option value="5.75">GMT+05:45</option>
                    <option value="6">GMT+06:00</option>
                    <option value="6.5">GMT+06:30</option>
                    <option value="7">GMT+07:00</option>
                    <option value="8" selected>GMT+08:00</option>
                    <option value="9">GMT+09:00</option>
                    <option value="9.5">GMT+09:30</option>
                    <option value="10">GMT+10:00</option>
                    <option value="10.5">GMT+10:30</option>
                    <option value="11">GMT+11:00</option>
                    <option value="12">GMT+12:00</option>
                </select>
                <div class="gmt-info">Select your current GMT, the place where you are departing from today.</div>
            </div>
            
            <div class="input-group">
                <label for="techLastDepartureGMT">Last Departure Station GMT</label>
                <select id="techLastDepartureGMT" class="gmt-select">
                    <option value="-12">GMT-12:00</option>
                    <option value="-11.75">GMT-11:45</option>
                    <option value="-11">GMT-11:00</option>
                    <option value="-10">GMT-10:00</option>
                    <option value="-9.5">GMT-09:30</option>
                    <option value="-9">GMT-09:00</option>
                    <option value="-8">GMT-08:00</option>
                    <option value="-7">GMT-07:00</option>
                    <option value="-6">GMT-06:00</option>
                    <option value="-5">GMT-05:00</option>
                    <option value="-4">GMT-04:00</option>
                    <option value="-3.5">GMT-03:30</option>
                    <option value="-3">GMT-03:00</option>
                    <option value="-2">GMT-02:00</option>
                    <option value="-1">GMT-01:00</option>
                    <option value="0">GMT+00:00</option>
                    <option value="1">GMT+01:00</option>
                    <option value="2">GMT+02:00</option>
                    <option value="3">GMT+03:00</option>
                    <option value="3.5">GMT+03:30</option>
                    <option value="4">GMT+04:00</option>
                    <option value="4.5">GMT+04:30</option>
                    <option value="5">GMT+05:00</option>
                    <option value="5.5">GMT+05:30</option>
                    <option value="5.75">GMT+05:45</option>
                    <option value="6">GMT+06:00</option>
                    <option value="6.5">GMT+06:30</option>
                    <option value="7">GMT+07:00</option>
                    <option value="8" selected>GMT+08:00</option>
                    <option value="9">GMT+09:00</option>
                    <option value="9.5">GMT+09:30</option>
                    <option value="10">GMT+10:00</option>
                    <option value="10.5">GMT+10:30</option>
                    <option value="11">GMT+11:00</option>
                    <option value="12">GMT+12:00</option>
                </select>
                <div class="gmt-info">Select last departure station timezone</div>
            </div>
            
            <div class="input-group">
                <label for="techLastDutyEnd">Last Duty End Date and Time</label>
                <div class="time-gmt-container">
                    <div class="time-input">
                        <input type="datetime-local" id="techLastDutyEnd" required>
                    </div>
                    <div class="gmt-input">
                        <select id="techLastDutyEndGMT" class="gmt-select">
                            <option value="-12">GMT-12:00</option>
                            <option value="-11.75">GMT-11:45</option>
                            <option value="-11">GMT-11:00</option>
                            <option value="-10">GMT-10:00</option>
                            <option value="-9.5">GMT-09:30</option>
                            <option value="-9">GMT-09:00</option>
                            <option value="-8">GMT-08:00</option>
                            <option value="-7">GMT-07:00</option>
                            <option value="-6">GMT-06:00</option>
                            <option value="-5">GMT-05:00</option>
                            <option value="-4">GMT-04:00</option>
                            <option value="-3.5">GMT-03:30</option>
                            <option value="-3">GMT-03:00</option>
                            <option value="-2">GMT-02:00</option>
                            <option value="-1">GMT-01:00</option>
                            <option value="0">GMT+00:00</option>
                            <option value="1">GMT+01:00</option>
                            <option value="2">GMT+02:00</option>
                            <option value="3">GMT+03:00</option>
                            <option value="3.5">GMT+03:30</option>
                            <option value="4">GMT+04:00</option>
                            <option value="4.5">GMT+04:30</option>
                            <option value="5">GMT+05:00</option>
                            <option value="5.5">GMT+05:30</option>
                            <option value="5.75">GMT+05:45</option>
                            <option value="6">GMT+06:00</option>
                            <option value="6.5">GMT+06:30</option>
                            <option value="7">GMT+07:00</option>
                            <option value="8" selected>GMT+08:00</option>
                            <option value="9">GMT+09:00</option>
                            <option value="9.5">GMT+09:30</option>
                            <option value="10">GMT+10:00</option>
                            <option value="10.5">GMT+10:30</option>
                            <option value="11">GMT+11:00</option>
                            <option value="12">GMT+12:00</option>
                        </select>
                    </div>
                </div>
                <div class="input-description">Check last duty end time in your roster (STA + 30 minutes) or (ATA + 30 minutes)</div>
            </div>
            
            <div class="input-group">
                <label for="techDutyStart">Start Time</label>
                <div class="time-gmt-container">
                    <div class="time-input">
                        <input type="datetime-local" id="techDutyStart" required>
                    </div>
                    <div class="gmt-input">
                        <select id="techStartGMT" class="gmt-select">
                            <option value="-12">GMT-12:00</option>
                            <option value="-11.75">GMT-11:45</option>
                            <option value="-11">GMT-11:00</option>
                            <option value="-10">GMT-10:00</option>
                            <option value="-9.5">GMT-09:30</option>
                            <option value="-9">GMT-09:00</option>
                            <option value="-8">GMT-08:00</option>
                            <option value="-7">GMT-07:00</option>
                            <option value="-6">GMT-06:00</option>
                            <option value="-5">GMT-05:00</option>
                            <option value="-4">GMT-04:00</option>
                            <option value="-3.5">GMT-03:30</option>
                            <option value="-3">GMT-03:00</option>
                            <option value="-2">GMT-02:00</option>
                            <option value="-1">GMT-01:00</option>
                            <option value="0">GMT+00:00</option>
                            <option value="1">GMT+01:00</option>
                            <option value="2">GMT+02:00</option>
                            <option value="3">GMT+03:00</option>
                            <option value="3.5">GMT+03:30</option>
                            <option value="4">GMT+04:00</option>
                            <option value="4.5">GMT+04:30</option>
                            <option value="5">GMT+05:00</option>
                            <option value="5.5">GMT+05:30</option>
                            <option value="5.75">GMT+05:45</option>
                            <option value="6">GMT+06:00</option>
                            <option value="6.5">GMT+06:30</option>
                            <option value="7">GMT+07:00</option>
                            <option value="8" selected>GMT+08:00</option>
                            <option value="9">GMT+09:00</option>
                            <option value="9.5">GMT+09:30</option>
                            <option value="10">GMT+10:00</option>
                            <option value="10.5">GMT+10:30</option>
                            <option value="11">GMT+11:00</option>
                            <option value="12">GMT+12:00</option>
                        </select>
                    </div>
                </div>
                <div class="input-description">Reporting time at Base/ ex-Station.</div>
            </div>
            
            <div class="input-group">
                <label for="techDutyEnd">End Time</label>
                <div class="time-gmt-container">
                    <div class="time-input">
                        <input type="datetime-local" id="techDutyEnd" required>
                    </div>
                    <div class="gmt-input">
                        <select id="techEndGMT" class="gmt-select">
                            <option value="-12">GMT-12:00</option>
                            <option value="-11.75">GMT-11:45</option>
                            <option value="-11">GMT-11:00</option>
                            <option value="-10">GMT-10:00</option>
                            <option value="-9.5">GMT-09:30</option>
                            <option value="-9">GMT-09:00</option>
                            <option value="-8">GMT-08:00</option>
                            <option value="-7">GMT-07:00</option>
                            <option value="-6">GMT-06:00</option>
                            <option value="-5">GMT-05:00</option>
                            <option value="-4">GMT-04:00</option>
                            <option value="-3.5">GMT-03:30</option>
                            <option value="-3">GMT-03:00</option>
                            <option value="-2">GMT-02:00</option>
                            <option value="-1">GMT-01:00</option>
                            <option value="0">GMT+00:00</option>
                            <option value="1">GMT+01:00</option>
                            <option value="2">GMT+02:00</option>
                            <option value="3">GMT+03:00</option>
                            <option value="3.5">GMT+03:30</option>
                            <option value="4">GMT+04:00</option>
                            <option value="4.5">GMT+04:30</option>
                            <option value="5">GMT+05:00</option>
                            <option value="5.5">GMT+05:30</option>
                            <option value="5.75">GMT+05:45</option>
                            <option value="6">GMT+06:00</option>
                            <option value="6.5">GMT+06:30</option>
                            <option value="7">GMT+07:00</option>
                            <option value="8" selected>GMT+08:00</option>
                            <option value="9">GMT+09:00</option>
                            <option value="9.5">GMT+09:30</option>
                            <option value="10">GMT+10:00</option>
                            <option value="10.5">GMT+10:30</option>
                            <option value="11">GMT+11:00</option>
                            <option value="12">GMT+12:00</option>
                        </select>
                    </div>
                </div>
                <div class="input-description">Final sector STA/ATA. FDP does not count +30 minutes post flight duty time.</div>
            </div>
            
            <div class="input-group">
                <label for="techSectors">Number of Sectors</label>
                <input type="number" id="techSectors" min="1" max="4" value="1" required>
            </div>
            
            <button id="calculateTechBtn">Calculate Tech Crew Limits</button>
            
            <div class="results" id="techResults">
                <div id="techResultContent">
                    <!-- Results will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Reference Tables -->
        <div class="table-section">
            <div class="section-title">Acclimatized Duty Limits</div>
            <div class="limits-info">
                <table class="limits-table">
                    <thead>
                        <tr>
                            <th>Start Time</th>
                            <th>Sectors</th>
                            <th>Cabin Crew Limit</th>
                            <th>Tech Crew Limit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>0600-0759</td><td>1</td><td>14:00</td><td>13:00</td></tr>
                        <tr><td>0600-0759</td><td>2</td><td>13:15</td><td>12:15</td></tr>
                        <tr><td>0600-0759</td><td>3</td><td>12:30</td><td>11:30</td></tr>
                        <tr><td>0600-0759</td><td>4</td><td>11:45</td><td>10:45</td></tr>
                        <tr><td>0800-1259</td><td>1</td><td>15:00</td><td>14:00</td></tr>
                        <tr><td>0800-1259</td><td>2</td><td>14:15</td><td>13:15</td></tr>
                        <tr><td>0800-1259</td><td>3</td><td>13:30</td><td>12:30</td></tr>
                        <tr><td>0800-1259</td><td>4</td><td>12:45</td><td>11:45</td></tr>
                        <tr><td>1300-1759</td><td>1</td><td>14:00</td><td>13:00</td></tr>
                        <tr><td>1300-1759</td><td>2</td><td>13:15</td><td>12:15</td></tr>
                        <tr><td>1300-1759</td><td>3</td><td>12:30</td><td>11:30</td></tr>
                        <tr><td>1300-1759</td><td>4</td><td>11:45</td><td>10:45</td></tr>
                        <tr><td>1800-2159</td><td>1</td><td>13:00</td><td>12:00</td></tr>
                        <tr><td>1800-2159</td><td>2</td><td>12:15</td><td>11:15</td></tr>
                        <tr><td>1800-2159</td><td>3</td><td>11:30</td><td>10:30</td></tr>
                        <tr><td>1800-2159</td><td>4</td><td>10:45</td><td>09:45</td></tr>
                        <tr><td>2200-0559</td><td>1</td><td>12:00</td><td>11:00</td></tr>
                        <tr><td>2200-0559</td><td>2</td><td>11:15</td><td>10:15</td></tr>
                        <tr><td>2200-0559</td><td>3</td><td>10:30</td><td>09:30</td></tr>
                        <tr><td>2200-0559</td><td>4</td><td>10:00</td><td>09:00</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="table-section">
            <div class="section-title">Non-Acclimatized Duty Limits</div>
            <div class="limits-info">
                <table class="limits-table">
                    <thead>
                        <tr>
                            <th>Rest Period</th>
                            <th>Sectors</th>
                            <th>Cabin Crew Limit</th>
                            <th>Tech Crew Limit</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td rowspan="4">≤18h OR ≥30h</td><td>1</td><td>14:00</td><td>13:00</td></tr>
                        <tr><td>2</td><td>13:15</td><td>12:15</td></tr>
                        <tr><td>3</td><td>12:30</td><td>11:30</td></tr>
                        <tr><td>4</td><td>11:45</td><td>10:45</td></tr>
                        <tr><td rowspan="4">18:01h to 29:59h</td><td>1</td><td>12:30</td><td>11:30</td></tr>
                        <tr><td>2</td><td>12:00</td><td>11:00</td></tr>
                        <tr><td>3</td><td>11:30</td><td>10:30</td></tr>
                        <tr><td>4</td><td>10:45</td><td>09:45</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="footnote">
            by 2100551 16/10/25
        </div>
    </div>

    <script>
        // Calculator selector functionality
        document.querySelectorAll('.calc-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons and forms
                document.querySelectorAll('.calc-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.calculator-form').forEach(form => form.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Show corresponding calculator form
                const calcType = this.getAttribute('data-calc');
                document.getElementById(`${calcType}-calculator`).classList.add('active');
            });
        });

        // Cabin Crew Calculator
        document.getElementById('calculateCabinBtn').addEventListener('click', function() {
            calculateCabin();
        });

        // Tech Crew Calculator
        document.getElementById('calculateTechBtn').addEventListener('click', function() {
            calculateTech();
        });

        // Common functions
        function getDutyLimitsFromTable(startTimeLocal, sectors, isAcclimatized, restHours = null, crewType = 'cabin') {
            const startHour = startTimeLocal.getHours();
            const startMinutes = startTimeLocal.getMinutes();
            const startTimeInMinutes = startHour * 60 + startMinutes;
            
            let cabinLimit = { hours: 0, minutes: 0 };
            let techLimit = { hours: 0, minutes: 0 };
            let tableReference = "";
            
            if (isAcclimatized) {
                // Use acclimatized table based on start time
                if (startTimeInMinutes >= 6*60 && startTimeInMinutes < 8*60) {
                    tableReference = "0600-0759";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 14, minutes: 0 }; techLimit = { hours: 13, minutes: 0 }; break;
                        case 2: cabinLimit = { hours: 13, minutes: 15 }; techLimit = { hours: 12, minutes: 15 }; break;
                        case 3: cabinLimit = { hours: 12, minutes: 30 }; techLimit = { hours: 11, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 11, minutes: 45 }; techLimit = { hours: 10, minutes: 45 }; break;
                    }
                } else if (startTimeInMinutes >= 8*60 && startTimeInMinutes < 13*60) {
                    tableReference = "0800-1259";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 15, minutes: 0 }; techLimit = { hours: 14, minutes: 0 }; break;
                        case 2: cabinLimit = { hours: 14, minutes: 15 }; techLimit = { hours: 13, minutes: 15 }; break;
                        case 3: cabinLimit = { hours: 13, minutes: 30 }; techLimit = { hours: 12, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 12, minutes: 45 }; techLimit = { hours: 11, minutes: 45 }; break;
                    }
                } else if (startTimeInMinutes >= 13*60 && startTimeInMinutes < 18*60) {
                    tableReference = "1300-1759";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 14, minutes: 0 }; techLimit = { hours: 13, minutes: 0 }; break;
                        case 2: cabinLimit = { hours: 13, minutes: 15 }; techLimit = { hours: 12, minutes: 15 }; break;
                        case 3: cabinLimit = { hours: 12, minutes: 30 }; techLimit = { hours: 11, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 11, minutes: 45 }; techLimit = { hours: 10, minutes: 45 }; break;
                    }
                } else if (startTimeInMinutes >= 18*60 && startTimeInMinutes < 22*60) {
                    tableReference = "1800-2159";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 13, minutes: 0 }; techLimit = { hours: 12, minutes: 0 }; break;
                        case 2: cabinLimit = { hours: 12, minutes: 15 }; techLimit = { hours: 11, minutes: 15 }; break;
                        case 3: cabinLimit = { hours: 11, minutes: 30 }; techLimit = { hours: 10, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 10, minutes: 45 }; techLimit = { hours: 9, minutes: 45 }; break;
                    }
                } else {
                    tableReference = "2200-0559";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 12, minutes: 0 }; techLimit = { hours: 11, minutes: 0 }; break;
                        case 2: cabinLimit = { hours: 11, minutes: 15 }; techLimit = { hours: 10, minutes: 15 }; break;
                        case 3: cabinLimit = { hours: 10, minutes: 30 }; techLimit = { hours: 9, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 10, minutes: 0 }; techLimit = { hours: 9, minutes: 0 }; break;
                    }
                }
            } else {
                // Use non-acclimatized table based on rest period
                if (restHours <= 18 || restHours >= 30) {
                    tableReference = "Rest ≤18h OR ≥30h";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 14, minutes: 0 }; techLimit = { hours: 13, minutes: 0 }; break;
                        case 2: cabinLimit = { hours: 13, minutes: 15 }; techLimit = { hours: 12, minutes: 15 }; break;
                        case 3: cabinLimit = { hours: 12, minutes: 30 }; techLimit = { hours: 11, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 11, minutes: 45 }; techLimit = { hours: 10, minutes: 45 }; break;
                    }
                } else {
                    tableReference = "Rest 18:01h-29:59h";
                    switch(sectors) {
                        case 1: cabinLimit = { hours: 12, minutes: 30 }; techLimit = { hours: 11, minutes: 30 }; break;
                        case 2: cabinLimit = { hours: 12, minutes: 0 }; techLimit = { hours: 11, minutes: 0 }; break;
                        case 3: cabinLimit = { hours: 11, minutes: 30 }; techLimit = { hours: 10, minutes: 30 }; break;
                        case 4: cabinLimit = { hours: 10, minutes: 45 }; techLimit = { hours: 9, minutes: 45 }; break;
                    }
                }
            }
            
            return crewType === 'cabin' ? 
                { limit: cabinLimit, tableReference } : 
                { limit: techLimit, tableReference };
        }

        function getLocalTimeFromInput(dateTimeStr, gmtOffset) {
            const date = new Date(dateTimeStr);
            const utcTime = date.getTime() + (date.getTimezoneOffset() * 60000);
            const localTime = new Date(utcTime + (gmtOffset * 3600000));
            return localTime;
        }

        function calculateDutyPeriodWithTimezone(startTimeStr, endTimeStr, startGMT, endGMT) {
            const startUTC = convertToUTC(startTimeStr, startGMT);
            const endUTC = convertToUTC(endTimeStr, endGMT);
            return endUTC - startUTC;
        }

        function convertToUTC(dateTimeStr, gmtOffset) {
            const date = new Date(dateTimeStr);
            return date.getTime() - (gmtOffset * 60 * 60 * 1000);
        }

        function checkAcclimatization(lastDutyEndStr, dutyStartStr, baseGMT, lastDepartureGMT, startGMT, lastDutyEndGMT) {
            const lastDutyEndUTC = convertToUTC(lastDutyEndStr, lastDutyEndGMT);
            const dutyStartUTC = convertToUTC(dutyStartStr, startGMT);
            const restMs = dutyStartUTC - lastDutyEndUTC;
            const restHours = restMs / (1000 * 60 * 60);
            
            const restHoursFormatted = Math.floor(restHours);
            const restMinutesFormatted = Math.floor((restHours % 1) * 60);
            const restPeriod = `${restHoursFormatted}h ${restMinutesFormatted}m`;
            
            const timezoneDifference = Math.abs(lastDepartureGMT - baseGMT);
            const timezoneExemption = timezoneDifference <= 2;
            
            let validNightPeriods = 0;
            let nightPeriods = [];
            
            const lastDutyEndLocal = getLocalTimeFromInput(lastDutyEndStr, lastDutyEndGMT);
            const dutyStartLocal = getLocalTimeFromInput(dutyStartStr, startGMT);
            
            let currentDate = new Date(lastDutyEndLocal);
            currentDate.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < 5; i++) {
                const nightStart = new Date(currentDate);
                nightStart.setHours(22, 0, 0, 0);
                
                const nightEnd = new Date(currentDate);
                nightEnd.setDate(nightEnd.getDate() + 1);
                nightEnd.setHours(8, 0, 0, 0);
                
                if (nightEnd <= lastDutyEndLocal || nightStart >= dutyStartLocal) {
                    currentDate.setDate(currentDate.getDate() + 1);
                    continue;
                }
                
                const overlapStart = new Date(Math.max(lastDutyEndLocal.getTime(), nightStart.getTime()));
                const overlapEnd = new Date(Math.min(dutyStartLocal.getTime(), nightEnd.getTime()));
                
                const overlapHours = (overlapEnd - overlapStart) / (1000 * 60 * 60);
                
                if (overlapHours > 0) {
                    const isValid = overlapHours >= 8;
                    if (isValid) validNightPeriods++;
                    
                    nightPeriods.push({
                        date: nightStart.toLocaleDateString(),
                        restHours: overlapHours,
                        isValid: isValid
                    });
                }
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            let status = 'danger';
            let message = 'Not Acclimatized';
            let isAcclimatized = false;
            
            if (timezoneExemption) {
                status = 'ok';
                message = 'Acclimatized (Timezone Exemption)';
                isAcclimatized = true;
            } else if (validNightPeriods >= 2 && restHours >= 34) {
                status = 'ok';
                message = 'Acclimatized';
                isAcclimatized = true;
            } else if (validNightPeriods >= 2 && restHours < 34) {
                status = 'warning';
                message = 'Night periods OK but rest < 34h';
            } else if (validNightPeriods < 2 && restHours >= 34) {
                status = 'warning';
                message = 'Rest period OK but insufficient night periods';
            }
            
            return {
                status: status,
                message: message,
                restPeriod: restPeriod,
                restHours: restHours,
                validNightPeriods: validNightPeriods,
                nightPeriods: nightPeriods,
                timezoneExemption: timezoneExemption,
                isAcclimatized: isAcclimatized
            };
        }

        // Cabin Crew Calculator Function
        function calculateCabin() {
            const baseGMT = parseFloat(document.getElementById('cabinBaseGMT').value);
            const lastDepartureGMT = parseFloat(document.getElementById('cabinLastDepartureGMT').value);
            const startGMT = parseFloat(document.getElementById('cabinStartGMT').value);
            const endGMT = parseFloat(document.getElementById('cabinEndGMT').value);
            const lastDutyEndGMT = parseFloat(document.getElementById('cabinLastDutyEndGMT').value);
            const lastDutyEnd = document.getElementById('cabinLastDutyEnd').value;
            const dutyStart = document.getElementById('cabinDutyStart').value;
            const dutyEnd = document.getElementById('cabinDutyEnd').value;
            const sectors = parseInt(document.getElementById('cabinSectors').value);
            const aircraftType = document.getElementById('cabinAircraftType').value;
            
            const dutyMs = calculateDutyPeriodWithTimezone(dutyStart, dutyEnd, startGMT, endGMT);
            const dutyHours = Math.floor(dutyMs / (1000 * 60 * 60));
            const dutyMinutes = Math.floor((dutyMs % (1000 * 60 * 60)) / (1000 * 60));
            const dutyTimeFormatted = `${dutyHours}h ${dutyMinutes}m`;
            
            const acclimatization = checkAcclimatization(lastDutyEnd, dutyStart, baseGMT, lastDepartureGMT, startGMT, lastDutyEndGMT);
            const startTimeLocal = getLocalTimeFromInput(dutyStart, startGMT);
            
            // Get cabin crew limits
            const { limit: cabinLimit, tableReference } = getDutyLimitsFromTable(
                startTimeLocal, 
                sectors, 
                acclimatization.isAcclimatized,
                acclimatization.restHours,
                'cabin'
            );
            
            const cabinLimitDecimal = cabinLimit.hours + (cabinLimit.minutes / 60);
            const dutyDecimal = dutyHours + (dutyMinutes / 60);
            const cabinStatus = dutyDecimal <= cabinLimitDecimal ? 'ok' : 'danger';
            
            let cabinDutyLimitFormatted = `${cabinLimit.hours}h`;
            if (cabinLimit.minutes > 0) {
                cabinDutyLimitFormatted += ` ${cabinLimit.minutes}m`;
            }
            
            const sectorLimit = 4;
            const sectorStatus = sectors <= sectorLimit ? 'ok' : 'danger';
            
            let resultHTML = '';
            
            // Aircraft info
            const aircraftTypeDisplay = aircraftType === '737' ? '737' : '332/333/339/350';
            resultHTML += `<div class="result-item ok">`;
            resultHTML += `<strong>Crew Type:</strong> Cabin Crew<br>`;
            resultHTML += `<strong>Aircraft Type:</strong> ${aircraftTypeDisplay}`;
            resultHTML += `</div>`;
            
            // Acclimatization result
            resultHTML += `<div class="result-item ${acclimatization.status}">`;
            resultHTML += `<strong>Acclimatization:</strong> ${acclimatization.message}<br>`;
            resultHTML += `<strong>Rest Period:</strong> ${acclimatization.restPeriod}<br>`;
            resultHTML += `<strong>Night Periods with 8+ hours rest:</strong> ${acclimatization.validNightPeriods} of 2 required`;
            
            if (acclimatization.timezoneExemption) {
                resultHTML += `<div class="gmt-comparison">`;
                resultHTML += `<strong>Timezone Exemption:</strong> Last departure station GMT${lastDepartureGMT >= 0 ? '+' : ''}${lastDepartureGMT} is within ±2 hours of Current GMT${baseGMT >= 0 ? '+' : ''}${baseGMT}`;
                resultHTML += `</div>`;
            }
            
            if (!acclimatization.isAcclimatized) {
                resultHTML += `<div class="non-acclimatized-info">`;
                resultHTML += `<strong>Non-Acclimatized Limits Applied:</strong> `;
                if (acclimatization.restHours <= 18 || acclimatization.restHours >= 30) {
                    resultHTML += `Rest period (${acclimatization.restPeriod}) is ≤18h OR ≥30h`;
                } else {
                    resultHTML += `Rest period (${acclimatization.restPeriod}) is between 18:01h and 29:59h`;
                }
                resultHTML += `</div>`;
            }
            
            if (acclimatization.nightPeriods.length > 0) {
                resultHTML += `<div class="night-periods">`;
                acclimatization.nightPeriods.forEach((period, index) => {
                    const status = period.restHours >= 8 ? '✓' : '✗';
                    resultHTML += `<div class="night-period">${status} Night ${index+1}: ${period.date} (${period.restHours.toFixed(1)}h rest)</div>`;
                });
                resultHTML += `</div>`;
            }
            
            resultHTML += `</div>`;
            
            // Duty period result
            resultHTML += `<div class="result-item">`;
            resultHTML += `<strong>Duty Period:</strong>`;
            resultHTML += `<div class="time-display">${dutyTimeFormatted}</div>`;
            
            const startTimeFormatted = startTimeLocal.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            resultHTML += `<div class="table-reference">Start Time: ${startTimeFormatted} (Local) - Reference: ${tableReference}, ${sectors} sector(s)</div>`;
            
            resultHTML += `<div class="crew-results">`;
            resultHTML += `<div class="crew-result ${cabinStatus}">`;
            resultHTML += `<div class="crew-title">Cabin Crew</div>`;
            resultHTML += `<strong>Limit:</strong> ${cabinDutyLimitFormatted}<br>`;
            resultHTML += cabinStatus === 'ok' ? 
                '✓ Within limit' : 
                '✗ Exceeds limit!';
            resultHTML += `</div>`;
            resultHTML += `</div>`;
            resultHTML += `</div>`;
            
            // Sectors result
            resultHTML += `<div class="result-item ${sectorStatus}">`;
            resultHTML += `<strong>Sectors:</strong> ${sectors}<br>`;
            resultHTML += `<strong>Limit:</strong> ${sectorLimit}<br>`;
            resultHTML += sectorStatus === 'ok' ? 
                '✓ Within limit' : 
                '✗ Exceeds limit!';
            resultHTML += `</div>`;
            
            document.getElementById('cabinResultContent').innerHTML = resultHTML;
            document.getElementById('cabinResults').style.display = 'block';
        }

        // Tech Crew Calculator Function
        function calculateTech() {
            const baseGMT = parseFloat(document.getElementById('techBaseGMT').value);
            const lastDepartureGMT = parseFloat(document.getElementById('techLastDepartureGMT').value);
            const startGMT = parseFloat(document.getElementById('techStartGMT').value);
            const endGMT = parseFloat(document.getElementById('techEndGMT').value);
            const lastDutyEndGMT = parseFloat(document.getElementById('techLastDutyEndGMT').value);
            const lastDutyEnd = document.getElementById('techLastDutyEnd').value;
            const dutyStart = document.getElementById('techDutyStart').value;
            const dutyEnd = document.getElementById('techDutyEnd').value;
            const sectors = parseInt(document.getElementById('techSectors').value);
            const aircraftType = document.getElementById('techAircraftType').value;
            
            const dutyMs = calculateDutyPeriodWithTimezone(dutyStart, dutyEnd, startGMT, endGMT);
            const dutyHours = Math.floor(dutyMs / (1000 * 60 * 60));
            const dutyMinutes = Math.floor((dutyMs % (1000 * 60 * 60)) / (1000 * 60));
            const dutyTimeFormatted = `${dutyHours}h ${dutyMinutes}m`;
            
            const acclimatization = checkAcclimatization(lastDutyEnd, dutyStart, baseGMT, lastDepartureGMT, startGMT, lastDutyEndGMT);
            const startTimeLocal = getLocalTimeFromInput(dutyStart, startGMT);
            
            // Get tech crew limits (no adjustment for widebody aircraft)
            const { limit: techLimit, tableReference } = getDutyLimitsFromTable(
                startTimeLocal, 
                sectors, 
                acclimatization.isAcclimatized,
                acclimatization.restHours,
                'tech'
            );
            
            // Apply special conditions for tech crew sector 1
            let finalTechLimit = { ...techLimit };
            let specialCondition = "";
            let tableRef = tableReference;
            
            if (sectors === 1) {
                const dutyDecimal = dutyHours + (dutyMinutes / 60);
                const techLimitDecimal = techLimit.hours + (techLimit.minutes / 60);
                
                if (acclimatization.isAcclimatized) {
                    const startHour = startTimeLocal.getHours();
                    const startMinutes = startTimeLocal.getMinutes();
                    const startTimeInMinutes = startHour * 60 + startMinutes;
                    
                    let timeBlock;
                    if (startTimeInMinutes >= 6*60 && startTimeInMinutes < 8*60) timeBlock = '0600-0759';
                    else if (startTimeInMinutes >= 8*60 && startTimeInMinutes < 13*60) timeBlock = '0800-1259';
                    else if (startTimeInMinutes >= 13*60 && startTimeInMinutes < 18*60) timeBlock = '1300-1759';
                    else if (startTimeInMinutes >= 18*60 && startTimeInMinutes < 22*60) timeBlock = '1800-2159';
                    else timeBlock = '2200-0559';
                    
                    if (dutyDecimal >= 7 && dutyDecimal < 9) {
                        specialCondition = "Duty period 7h-8h59m, Sector 1";
                        tableRef += " (Special Condition)";
                        switch(timeBlock) {
                            case '0600-0759': finalTechLimit = { hours: 12, minutes: 15 }; break;
                            case '0800-1259': finalTechLimit = { hours: 13, minutes: 15 }; break;
                            case '1300-1759': finalTechLimit = { hours: 12, minutes: 15 }; break;
                            case '1800-2159': finalTechLimit = { hours: 11, minutes: 15 }; break;
                            case '2200-0559': finalTechLimit = { hours: 10, minutes: 15 }; break;
                        }
                    } else if (dutyDecimal >= 9 && dutyDecimal < 11) {
                        specialCondition = "Duty period 9h-10h59m, Sector 1";
                        tableRef += " (Special Condition)";
                        switch(timeBlock) {
                            case '0600-0759': finalTechLimit = { hours: 11, minutes: 30 }; break;
                            case '0800-1259': finalTechLimit = { hours: 12, minutes: 30 }; break;
                            case '1300-1759': finalTechLimit = { hours: 11, minutes: 30 }; break;
                            case '1800-2159': finalTechLimit = { hours: 10, minutes: 30 }; break;
                            case '2200-0559': finalTechLimit = { hours: 9, minutes: 30 }; break;
                        }
                    } else if (dutyDecimal >= 11) {
                        specialCondition = "Duty period 11h+, Sector 1";
                        tableRef += " (Special Condition)";
                        switch(timeBlock) {
                            case '0600-0759': finalTechLimit = { hours: 10, minutes: 45 }; break;
                            case '0800-1259': finalTechLimit = { hours: 11, minutes: 45 }; break;
                            case '1300-1759': finalTechLimit = { hours: 10, minutes: 45 }; break;
                            case '1800-2159': finalTechLimit = { hours: 9, minutes: 45 }; break;
                            case '2200-0559': finalTechLimit = { hours: 9, minutes: 0 }; break;
                        }
                    }
                } else {
                    if (dutyDecimal >= 7 && dutyDecimal < 9) {
                        specialCondition = "Duty period 7h-8h59m, Sector 1";
                        tableRef += " (Special Condition)";
                        if (acclimatization.restHours <= 18 || acclimatization.restHours >= 30) {
                            finalTechLimit = { hours: 10, minutes: 45 };
                        } else {
                            finalTechLimit = { hours: 9, minutes: 45 };
                        }
                    } else if (dutyDecimal >= 9 && dutyDecimal < 11) {
                        specialCondition = "Duty period 9h-10h59m, Sector 1";
                        tableRef += " (Special Condition)";
                        if (acclimatization.restHours <= 18 || acclimatization.restHours >= 30) {
                            finalTechLimit = { hours: 10, minutes: 45 };
                        } else {
                            finalTechLimit = { hours: 9, minutes: 45 };
                        }
                    } else if (dutyDecimal >= 11) {
                        specialCondition = "Duty period 11h+, Sector 1 - NOT ALLOWED";
                        tableRef += " (Special Condition)";
                        finalTechLimit = null;
                    }
                }
            }
            
            const techLimitDecimal = finalTechLimit ? finalTechLimit.hours + (finalTechLimit.minutes / 60) : null;
            const dutyDecimal = dutyHours + (dutyMinutes / 60);
            const techStatus = techLimitDecimal !== null && dutyDecimal <= techLimitDecimal ? 'ok' : 'danger';
            
            let techDutyLimitFormatted = "N/A";
            if (finalTechLimit) {
                techDutyLimitFormatted = `${finalTechLimit.hours}h`;
                if (finalTechLimit.minutes > 0) {
                    techDutyLimitFormatted += ` ${finalTechLimit.minutes}m`;
                }
            }
            
            const sectorLimit = 4;
            const sectorStatus = sectors <= sectorLimit ? 'ok' : 'danger';
            
            let resultHTML = '';
            
            // Aircraft info
            const aircraftTypeDisplay = aircraftType === '737' ? '737' : '332/333/339/350';
            resultHTML += `<div class="result-item ok">`;
            resultHTML += `<strong>Crew Type:</strong> Tech Crew<br>`;
            resultHTML += `<strong>Aircraft Type:</strong> ${aircraftTypeDisplay}`;
            resultHTML += `</div>`;
            
            // Acclimatization result
            resultHTML += `<div class="result-item ${acclimatization.status}">`;
            resultHTML += `<strong>Acclimatization:</strong> ${acclimatization.message}<br>`;
            resultHTML += `<strong>Rest Period:</strong> ${acclimatization.restPeriod}<br>`;
            resultHTML += `<strong>Night Periods with 8+ hours rest:</strong> ${acclimatization.validNightPeriods} of 2 required`;
            
            if (acclimatization.timezoneExemption) {
                resultHTML += `<div class="gmt-comparison">`;
                resultHTML += `<strong>Timezone Exemption:</strong> Last departure station GMT${lastDepartureGMT >= 0 ? '+' : ''}${lastDepartureGMT} is within ±2 hours of Current GMT${baseGMT >= 0 ? '+' : ''}${baseGMT}`;
                resultHTML += `</div>`;
            }
            
            if (!acclimatization.isAcclimatized) {
                resultHTML += `<div class="non-acclimatized-info">`;
                resultHTML += `<strong>Non-Acclimatized Limits Applied:</strong> `;
                if (acclimatization.restHours <= 18 || acclimatization.restHours >= 30) {
                    resultHTML += `Rest period (${acclimatization.restPeriod}) is ≤18h OR ≥30h`;
                } else {
                    resultHTML += `Rest period (${acclimatization.restPeriod}) is between 18:01h and 29:59h`;
                }
                resultHTML += `</div>`;
            }
            
            if (acclimatization.nightPeriods.length > 0) {
                resultHTML += `<div class="night-periods">`;
                acclimatization.nightPeriods.forEach((period, index) => {
                    const status = period.restHours >= 8 ? '✓' : '✗';
                    resultHTML += `<div class="night-period">${status} Night ${index+1}: ${period.date} (${period.restHours.toFixed(1)}h rest)</div>`;
                });
                resultHTML += `</div>`;
            }
            
            resultHTML += `</div>`;
            
            // Duty period result
            resultHTML += `<div class="result-item">`;
            resultHTML += `<strong>Duty Period:</strong>`;
            resultHTML += `<div class="time-display">${dutyTimeFormatted}</div>`;
            
            const startTimeFormatted = startTimeLocal.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            resultHTML += `<div class="table-reference">Start Time: ${startTimeFormatted} (Local) - Reference: ${tableRef}, ${sectors} sector(s)</div>`;
            
            resultHTML += `<div class="crew-results">`;
            resultHTML += `<div class="crew-result ${techStatus}">`;
            resultHTML += `<div class="crew-title">Tech Crew</div>`;
            resultHTML += `<strong>Limit:</strong> ${techDutyLimitFormatted}<br>`;
            if (specialCondition) {
                resultHTML += `<div class="special-condition">${specialCondition}</div>`;
            }
            if (techDutyLimitFormatted === "N/A") {
                resultHTML += 'N/A - Not applicable';
            } else {
                resultHTML += techStatus === 'ok' ? 
                    '✓ Within limit' : 
                    '✗ Exceeds limit!';
            }
            resultHTML += `</div>`;
            resultHTML += `</div>`;
            resultHTML += `</div>`;
            
            // Sectors result
            resultHTML += `<div class="result-item ${sectorStatus}">`;
            resultHTML += `<strong>Sectors:</strong> ${sectors}<br>`;
            resultHTML += `<strong>Limit:</strong> ${sectorLimit}<br>`;
            resultHTML += sectorStatus === 'ok' ? 
                '✓ Within limit' : 
                '✗ Exceeds limit!';
            resultHTML += `</div>`;
            
            document.getElementById('techResultContent').innerHTML = resultHTML;
            document.getElementById('techResults').style.display = 'block';
        }

        // Set default date/time values
        window.onload = function() {
            const now = new Date();
            const formatDateTime = (date) => date.toISOString().slice(0, 16);
            
            // Set all datetime inputs to current device date and time
            const dateInputs = [
                'cabinLastDutyEnd', 'cabinDutyStart', 'cabinDutyEnd',
                'techLastDutyEnd', 'techDutyStart', 'techDutyEnd'
            ];
            
            dateInputs.forEach(id => {
                document.getElementById(id).value = formatDateTime(now);
            });
            
            // Set GMT defaults to +8
            const gmtSelects = [
                'cabinBaseGMT', 'cabinLastDepartureGMT', 'cabinLastDutyEndGMT', 'cabinStartGMT', 'cabinEndGMT',
                'techBaseGMT', 'techLastDepartureGMT', 'techLastDutyEndGMT', 'techStartGMT', 'techEndGMT'
            ];
            
            gmtSelects.forEach(id => {
                document.getElementById(id).value = "8";
            });
            
            // Set default aircraft types
            document.getElementById('cabinAircraftType').value = "737";
            document.getElementById('techAircraftType').value = "737";
        };
    </script>
</body>
</html>